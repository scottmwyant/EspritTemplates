<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Custom Operation Setup Sheet</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="tutorial.css" rel="stylesheet" type="text/css" />
<link href="tab.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="tab.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Custom Operation Setup Sheet </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this tutorial, a more general setup sheet for the machining operations will be created. Obviously that will involve the operation technology objects, but for those operations, we may also want to get information on the tool that is being used. So the tooling technology will also be needed. Once again we will present the user with a dialog from which he could pick the property names. One list on the dialog will show all of the properties he could choose from, the other will list the ones that had been chosen. A pull down could let him pick between various categories of properties. The setup sheet will once again be written out as a .csv file. The user can later write an Excel macro to customize the fonts and other display formatting.</p>
<p>The properties that are chosen should be recorded so that the setup sheet defaults to using those properties the next time it is run. It would also be nice to add up and down command buttons to let the user rearrange the order of the chosen properties.</p>
<div class="image">
<img src="CustomOperationSetupSheetTutorial.png" alt=""/>
</div>
<p>Set the properties of each control to the following values:</p>
<center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Object Type </th><th class="markdownTableHeadCenter">Name </th><th class="markdownTableHeadCenter">Properties  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">UserForm </td><td class="markdownTableBodyCenter">ToolSetupSheetForm </td><td class="markdownTableBodyCenter">Caption = Tool Setup Sheet  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ComboBox </td><td class="markdownTableBodyCenter">CycleType </td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ListBox </td><td class="markdownTableBodyCenter">AvailableProperties </td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ListBox </td><td class="markdownTableBodyCenter">OutputProperties </td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CommandButton </td><td class="markdownTableBodyCenter">UpButton </td><td class="markdownTableBodyCenter">Caption = Up  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CommandButton </td><td class="markdownTableBodyCenter">RemoveButton </td><td class="markdownTableBodyCenter">Caption = &lt;-  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CommandButton </td><td class="markdownTableBodyCenter">AddButton </td><td class="markdownTableBodyCenter">Caption = -&gt;  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CommandButton </td><td class="markdownTableBodyCenter">DownButton </td><td class="markdownTableBodyCenter">Caption = Down  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CommandButton </td><td class="markdownTableBodyCenter">OkButton </td><td class="markdownTableBodyCenter">Caption = OK  </td></tr>
</table>
</center><p>Assosiate the following event procedures with the form:</p>
<div class="tab"> <div class="tablinks" onclick="openTab(event, &apos;CShsnippet&apos;, &apos;tabcontent1&apos;, &apos;tablinks&apos;)">C#</div> </div><div id="CShsnippet" class="tabcontent1"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnUpButtonClick(<span class="keywordtype">object</span> sender, RoutedEventArgs e)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (_dialog.OutputProperties.SelectedIndex &gt; 0)</div>
<div class="line">            {</div>
<div class="line">                var i = _dialog.OutputProperties.SelectedIndex;</div>
<div class="line">                var tempItem = _dialog.OutputProperties.Items[i - 1];</div>
<div class="line">                _dialog.OutputProperties.Items[i - 1] = _dialog.OutputProperties.Items[i];</div>
<div class="line">                _dialog.OutputProperties.Items[i] = tempItem;</div>
<div class="line"> </div>
<div class="line">                _dialog.OutputProperties.SelectedIndex = i - 1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnDownButtonClick(<span class="keywordtype">object</span> sender, RoutedEventArgs e)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (_dialog.OutputProperties.SelectedIndex &gt;= 0 &amp;&amp; _dialog.OutputProperties.SelectedIndex != _dialog.OutputProperties.Items.Count)</div>
<div class="line">            {</div>
<div class="line">                var i = _dialog.OutputProperties.SelectedIndex;</div>
<div class="line">                var tempItem = _dialog.OutputProperties.Items[i + 1];</div>
<div class="line">                _dialog.OutputProperties.Items[i + 1] = _dialog.OutputProperties.Items[i];</div>
<div class="line">                _dialog.OutputProperties.Items[i] = tempItem;</div>
<div class="line"> </div>
<div class="line">                _dialog.OutputProperties.SelectedIndex = i + 1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> CycleType_SelectionChanged(<span class="keywordtype">object</span> sender, System.Windows.Controls.SelectionChangedEventArgs e)</div>
<div class="line">        {</div>
<div class="line">            var comboBox = sender as System.Windows.Controls.ComboBox;</div>
<div class="line">            var comboBoxItem = comboBox.SelectedItem as System.Windows.Controls.ComboBoxItem;</div>
<div class="line"> </div>
<div class="line">            SetAvailablePropertiesList(comboBoxItem.Content.ToString());</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> SetAvailablePropertiesList(<span class="keywordtype">string</span> type)</div>
<div class="line">        {</div>
<div class="line">            _dialog.AvailableProperties.Items.Clear();</div>
<div class="line">            var codes = _codeNames[type];</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">foreach</span> (var item <span class="keywordflow">in</span> codes)</div>
<div class="line">            {</div>
<div class="line">                _dialog.AvailableProperties.Items.Add(item);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> RemoveButtonClick(<span class="keywordtype">object</span> sender, RoutedEventArgs e)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (var i = 0; i &lt; _dialog.OutputProperties.Items.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (_dialog.OutputProperties.SelectedIndex == i)</div>
<div class="line">                {</div>
<div class="line">                    _outputToolPropertyNames.Remove(_dialog.OutputProperties.Items.GetItemAt(i).ToString());</div>
<div class="line">                    _dialog.OutputProperties.Items.RemoveAt(i);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> AddButtonClick(<span class="keywordtype">object</span> sender, RoutedEventArgs e)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (var i = 0; i &lt; _dialog.AvailableProperties.Items.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (_dialog.AvailableProperties.SelectedIndex == i)</div>
<div class="line">                {</div>
<div class="line">                    var value = _dialog.AvailableProperties.Items.GetItemAt(i).ToString();</div>
<div class="line">                    <span class="keywordflow">if</span> (!_outputToolPropertyNames.Contains(value))</div>
<div class="line">                    {</div>
<div class="line">                        _outputToolPropertyNames.Add(value);</div>
<div class="line">                        _dialog.OutputProperties.Items.Add(value);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnApplyButtonClick(<span class="keywordtype">object</span> sender, RoutedEventArgs e)</div>
<div class="line">        {</div>
<div class="line">            _dialog.Close();</div>
<div class="line"> </div>
<div class="line">            var header = <span class="keywordtype">string</span>.Empty;</div>
<div class="line">            <span class="keywordflow">for</span> (var i = 0; i &lt; _outputToolPropertyNames.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (header.Length != 0)</div>
<div class="line">                {</div>
<div class="line">                    header += <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                header += _outputToolPropertyNames[i];</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            var filePath = Path.Combine(EspritApplication.TempDir, Guid.NewGuid().ToString() + <span class="stringliteral">&quot;.csv&quot;</span>);</div>
<div class="line">            <span class="keyword">using</span> (var outStream = <span class="keyword">new</span> StreamWriter(filePath))</div>
<div class="line">            {</div>
<div class="line">                outStream.WriteLine(header);</div>
<div class="line"> </div>
<div class="line">                var tools = Document.Tools as EspritTools.Tools;</div>
<div class="line">                <span class="keywordflow">foreach</span> (Esprit.PartOperation operation in Document.PartOperations)</div>
<div class="line">                {</div>
<div class="line">                    var opTech = operation.Technology as EspritTechnology.Technology;</div>
<div class="line">                    String dataItem = <span class="keywordtype">string</span>.Empty;</div>
<div class="line">                    var operationData = <span class="keywordtype">string</span>.Empty;</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">for</span> (var i = 0; i &lt; _outputToolPropertyNames.Count; i++)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">if</span> (operationData.Length != 0)</div>
<div class="line">                        {</div>
<div class="line">                            operationData += <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">                        }</div>
<div class="line"> </div>
<div class="line">                        var param = opTech.FindParameter(_outputToolPropertyNames[i]);</div>
<div class="line">                        <span class="keywordflow">if</span> (param == <span class="keyword">null</span>)</div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">try</span></div>
<div class="line">                            {</div>
<div class="line">                                var toolTech = tools[opTech.FindParameter(<span class="stringliteral">&quot;ToolID&quot;</span>).Value] as EspritTechnology.Technology;</div>
<div class="line">                                param = toolTech.FindParameter(_outputToolPropertyNames[i]);</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">catch</span> (Exception)</div>
<div class="line">                            { }</div>
<div class="line">                        }</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> (param == <span class="keyword">null</span>)</div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">switch</span>(_outputToolPropertyNames[i])</div>
<div class="line">                            {</div>
<div class="line">                                <span class="keywordflow">case</span> <span class="stringliteral">&quot;CycleTime&quot;</span>:</div>
<div class="line">                                    dataItem = operation.CycleTime.ToString();</div>
<div class="line">                                    <span class="keywordflow">break</span>;</div>
<div class="line">                                <span class="keywordflow">case</span> <span class="stringliteral">&quot;LayerName&quot;</span>:</div>
<div class="line">                                    dataItem = operation.Layer.Name;</div>
<div class="line">                                    <span class="keywordflow">break</span>;</div>
<div class="line">                                <span class="keywordflow">case</span> <span class="stringliteral">&quot;OperationNumber&quot;</span>:</div>
<div class="line">                                    dataItem = operation.Key;</div>
<div class="line">                                    <span class="keywordflow">break</span>;</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                        {</div>
<div class="line">                            dataItem = param.Value.ToString();</div>
<div class="line">                        }</div>
<div class="line">                            </div>
<div class="line">                        <span class="keywordflow">if</span> (dataItem != <span class="keywordtype">string</span>.Empty)</div>
<div class="line">                        {</div>
<div class="line">                            operationData += dataItem;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (operationData.Length != 0)</div>
<div class="line">                    {</div>
<div class="line">                        outStream.WriteLine(operationData);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                EspritApplication.EventWindow.AddMessage(EspritConstants.espMessageType.espMessageTypeInformation, <span class="stringliteral">&quot;CustomOperationSetupSheetTutorial&quot;</span>, $<span class="stringliteral">&quot;File created: {filePath}&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> FindToolPropertyNames()</div>
<div class="line">        {</div>
<div class="line">            _codeNames.Clear();</div>
<div class="line">            _outputToolPropertyNames.Clear();</div>
<div class="line"> </div>
<div class="line">            _codeNames.Add(<span class="stringliteral">&quot;All Codes&quot;</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">            _codeNames.Add(<span class="stringliteral">&quot;All Operations&quot;</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">            _codeNames.Add(<span class="stringliteral">&quot;Lathe Operations&quot;</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">            _codeNames.Add(<span class="stringliteral">&quot;Mill Operations&quot;</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">            _codeNames.Add(<span class="stringliteral">&quot;All Tools&quot;</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">            _codeNames.Add(<span class="stringliteral">&quot;Lathe Tools&quot;</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">            _codeNames.Add(<span class="stringliteral">&quot;Mill Tools&quot;</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">            _codeNames.Add(<span class="stringliteral">&quot;Other&quot;</span>, <span class="keyword">new</span> List&lt;string&gt;()</div>
<div class="line">            {</div>
<div class="line">                <span class="stringliteral">&quot;CycleTime&quot;</span>,</div>
<div class="line">                <span class="stringliteral">&quot;LayerName&quot;</span>,</div>
<div class="line">                <span class="stringliteral">&quot;OperationNumber&quot;</span></div>
<div class="line">            });</div>
<div class="line"> </div>
<div class="line">            var groups = <span class="keyword">new</span> Dictionary&lt;string, string&gt;()</div>
<div class="line">            {</div>
<div class="line">                {<span class="stringliteral">&quot;T&quot;</span>, <span class="stringliteral">&quot;All Codes&quot;</span> },</div>
<div class="line">                {<span class="stringliteral">&quot;Tech&quot;</span>, <span class="stringliteral">&quot;All Operations&quot;</span> },</div>
<div class="line">                {<span class="stringliteral">&quot;TechLathe&quot;</span>, <span class="stringliteral">&quot;Lathe Operations&quot;</span> },</div>
<div class="line">                {<span class="stringliteral">&quot;TechMill&quot;</span>, <span class="stringliteral">&quot;Mill Operations&quot;</span> },</div>
<div class="line">                {<span class="stringliteral">&quot;Tool&quot;</span>, <span class="stringliteral">&quot;All Tools&quot;</span> },</div>
<div class="line">                {<span class="stringliteral">&quot;ToolLathe&quot;</span>, <span class="stringliteral">&quot;Lathe Tools&quot;</span> },</div>
<div class="line">                {<span class="stringliteral">&quot;ToolMill&quot;</span>, <span class="stringliteral">&quot;Mill Tools&quot;</span> }</div>
<div class="line">            };</div>
<div class="line"> </div>
<div class="line">            var technologyUtility = Document.TechnologyUtility as EspritTechnology.TechnologyUtility;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">foreach</span> (espTechnologyType technologyType <span class="keywordflow">in</span> Enum.GetValues(typeof(espTechnologyType)))</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">try</span></div>
<div class="line">                {</div>
<div class="line">                    var technology = technologyUtility.CreateTechnology(technologyType, Document.SystemUnit);</div>
<div class="line">                    <span class="keywordflow">if</span> (technology != <span class="keyword">null</span>)</div>
<div class="line">                    {</div>
<div class="line">                        var techName = Microsoft.VisualBasic.Information.TypeName(technology);</div>
<div class="line">                        techName = techName.Substring(1);</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">foreach</span> (var name <span class="keywordflow">in</span> groups.Keys)</div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">if</span> (techName.StartsWith(name))</div>
<div class="line">                            {</div>
<div class="line">                                var list = _codeNames[groups[name]];</div>
<div class="line">                                <span class="keywordflow">for</span> (var j = 1; j &lt;= technology.Count; j++)</div>
<div class="line">                                {</div>
<div class="line">                                    <span class="keywordflow">if</span> (!list.Contains(technology[j].Name))</div>
<div class="line">                                    {</div>
<div class="line">                                        list.Add(technology[j].Name);</div>
<div class="line">                                    }</div>
<div class="line">                                }</div>
<div class="line"> </div>
<div class="line">                                _codeNames[groups[name]] = list;</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">catch</span> (Exception)</div>
<div class="line">                { }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>To launch the tutorial execute the following code in your main procedure:</p>
<div class="tab"> <div class="tablinks2" onclick="openTab(event, &apos;CShsnippet2&apos;, &apos;tabcontent2&apos;, &apos;tablinks2&apos;)">C#</div> </div><div id="CShsnippet2" class="tabcontent2"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> CustomOperationSetupSheet()</div>
<div class="line">        {</div>
<div class="line">            FindToolPropertyNames();</div>
<div class="line"> </div>
<div class="line">            _dialog = <span class="keyword">new</span> Tutorial_CustomOperationSetupSheet.OperationSetupSheetDialog();</div>
<div class="line">            _dialog.OkButton.Click += OnApplyButtonClick;</div>
<div class="line">            _dialog.AddButton.Click += AddButtonClick;</div>
<div class="line">            _dialog.RemoveButton.Click += RemoveButtonClick;</div>
<div class="line">            _dialog.CycleType.SelectionChanged += CycleType_SelectionChanged;</div>
<div class="line">            _dialog.UpButton.Click += OnUpButtonClick;</div>
<div class="line">            _dialog.DownButton.Click += OnDownButtonClick;</div>
<div class="line"> </div>
<div class="line">            SetAvailablePropertiesList(_dialog.CycleType.Text);</div>
<div class="line"> </div>
<div class="line">            _dialog.ShowDialog();</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript" src="restoreTabs.js"></script>
</body>
</html>
