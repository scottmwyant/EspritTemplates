<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Making a FeatureChain into a Spiral</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="tutorial.css" rel="stylesheet" type="text/css" />
<link href="tab.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="tab.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Making a FeatureChain into a Spiral </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>FeatureChain objects as well as FeaturePtop have a Count and an Item. The major difference is that FeaturePtop.Item directly returns a Point, whereas FeatureChain.Item will return a generic GraphicObject. That GraphicObject could be an Arc or a Segment.</p>
<p>For example, say that you have some closed contours that you wish to spiral cut. Instead of just programming a contour operation to do several incremental depth layers, you want to have the feature spiral downward, and then program a contour to follow that FeatureChain. What we will need to do is loop through the items in the original FeatureChain, apply the ramping to them, and include them in the new spiral feature.</p>
<p>In this example only the segments will be ramped. The arcs will have a constant Z value. The ratio of the lengths of the segments will be used so as to maintain a constant ramp angle on each one.</p>
<div class="tab"> <div class="tablinks" onclick="openTab(event, &apos;CShsnippet&apos;, &apos;tabcontent1&apos;, &apos;tablinks&apos;)">C#</div> </div><div id="CShsnippet" class="tabcontent1"> <div> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> SpiralClosedFeature()</div>
<div class="line">        {</div>
<div class="line">            Esprit.FeatureChain featureChain = <span class="keyword">null</span>;</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                featureChain = Document.GetAnyElement(<span class="stringliteral">&quot;Pick Feature Chain to Spiral&quot;</span>, EspritConstants.espGraphicObjectType.espFeatureChain) as Esprit.FeatureChain;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (System.Runtime.InteropServices.COMException)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Element was not set</span></div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (featureChain == <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!featureChain.IsClosed)</div>
<div class="line">            {</div>
<div class="line">                System.Windows.MessageBox.Show(<span class="stringliteral">&quot;Feature chain must be closed!&quot;</span>, <span class="stringliteral">&quot;FeatureChainIntoSpiralTutorial&quot;</span>, MessageBoxButton.OK);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">            var totalSegmentLength = 0.0;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (var i = 1; i &lt;= featureChain.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (featureChain.Item[i].GraphicObjectType == EspritConstants.espGraphicObjectType.espSegment)</div>
<div class="line">                {</div>
<div class="line">                    var segment = featureChain.Item[i] as Esprit.Segment;</div>
<div class="line">                    totalSegmentLength += segment.Length;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (totalSegmentLength == 0)</div>
<div class="line">            {</div>
<div class="line">                System.Windows.MessageBox.Show(<span class="stringliteral">&quot;Cannot spiral feature containing only arcs!&quot;</span>, <span class="stringliteral">&quot;FeatureChainIntoSpiralTutorial&quot;</span>, MessageBoxButton.OK);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            var totalDepth = (Document.SystemUnit == EspritConstants.espUnitType.espInch)</div>
<div class="line">                ? 1.0</div>
<div class="line">                : 25.0;</div>
<div class="line"> </div>
<div class="line">            var valueEntered = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">do</span></div>
<div class="line">            {</div>
<div class="line">                valueEntered = RequestUserInput(<span class="stringliteral">&quot;Enter Total Depth&quot;</span>, <span class="stringliteral">&quot;Total Depth&quot;</span>, ref totalDepth);</div>
<div class="line">            } <span class="keywordflow">while</span> (!valueEntered);</div>
<div class="line"> </div>
<div class="line">            totalDepth = Math.Abs(totalDepth);</div>
<div class="line">            var maxIncrementalDepth = totalDepth / 10;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!RequestUserInput(<span class="stringliteral">&quot;Enter Maximum Incremental Depth&quot;</span>, <span class="stringliteral">&quot;Max Increment&quot;</span>, ref maxIncrementalDepth))</div>
<div class="line">            {</div>
<div class="line">                maxIncrementalDepth = totalDepth;</div>
<div class="line">            }</div>
<div class="line">            var numberOfPasses = (int)(totalDepth / maxIncrementalDepth);</div>
<div class="line">            <span class="keywordflow">if</span> (totalDepth / maxIncrementalDepth &gt; numberOfPasses)</div>
<div class="line">            {</div>
<div class="line">                numberOfPasses++;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            maxIncrementalDepth = totalDepth / numberOfPasses;</div>
<div class="line"> </div>
<div class="line">            var spiral = Document.FeatureChains.Add(featureChain.Extremity(EspritConstants.espExtremityType.espExtremityStart));</div>
<div class="line">            spiral.Color = featureChain.Color;</div>
<div class="line">            spiral.LineType = featureChain.LineType;</div>
<div class="line">            spiral.LineWeight = featureChain.LineWeight;</div>
<div class="line"> </div>
<div class="line">            var currentDepth = spiral.Extremity(EspritConstants.espExtremityType.espExtremityStart).Z;</div>
<div class="line">            numberOfPasses++;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (var pass = 1; pass &lt;= numberOfPasses; pass++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">for</span> (var i = 1; i &lt;= featureChain.Count; i++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">switch</span> (featureChain.Item[i].GraphicObjectType)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espArc:</div>
<div class="line">                            var arc = featureChain.Item[i] as Esprit.Arc;</div>
<div class="line">                            var centralPoint = arc.CenterPoint;</div>
<div class="line">                            centralPoint = Document.GetPoint(centralPoint.X, centralPoint.Y, currentDepth);</div>
<div class="line"> </div>
<div class="line">                            <span class="keywordflow">try</span></div>
<div class="line">                            {</div>
<div class="line">                                arc = Document.GetArc(centralPoint, arc.Radius, arc.StartAngle, arc.EndAngle);</div>
<div class="line">                                spiral.Add(arc);</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">catch</span> (System.Runtime.InteropServices.COMException)</div>
<div class="line">                            {</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espSegment:</div>
<div class="line">                            var segment = featureChain.Item[i] as Esprit.Segment;</div>
<div class="line">                            <span class="keywordflow">if</span> (pass &lt; numberOfPasses)</div>
<div class="line">                            {</div>
<div class="line">                                currentDepth -= maxIncrementalDepth * segment.Length / totalSegmentLength;</div>
<div class="line">                            }</div>
<div class="line">                            spiral.Add(Document.GetPoint(segment.XEnd, segment.YEnd, currentDepth));</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div></div><div id="CShsnippet" class="tabcontent1"></div><p>Note that for some FeatureChain objects, the code above might fail when extracting the arcs and adding them to the spiral. This is because the arc inside the original FeatureChain may have its own local plane that does not match the XY plane. The StartAngle and EndAngle values will be with respect to that local plane, and so they may not be correct for adding them to the new FeatureChain. The angles need to be reset to the correct plane. In order to do a spiral, the FeatureChain had to be closed. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript" src="restoreTabs.js"></script>
</body>
</html>
