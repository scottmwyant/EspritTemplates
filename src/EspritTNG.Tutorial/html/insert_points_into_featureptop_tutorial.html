<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Inserting Points into a FeaturePtop</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="tutorial.css" rel="stylesheet" type="text/css" />
<link href="tab.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="tab.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Inserting Points into a FeaturePtop </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial shows how to insert a point to a FeaturePtop. The code prompts the user to pick the FeaturePtop, pick the insertion location, and then the Point to insert, and than it inserts the selected point to a chosen locsation.</p>
<p>Now for the insertion location, there are several possibilities. For example, we could essentially Smash the FeaturePtop (inside of a SelectionSet), so that points were created at each location, then expect the user to pick one of those points. This may not be a good solution, though, because the user may have already had points there. As an alternative, we could use Grid mode, and expect the user to pick a grid point close to the location. Then we can just determine what location the user picked closest too.</p>
<p>Note that while FeaturePtop objects have Add, Count, and Item, they do not have Remove or Insert. So we cannot modify the end of the original FeaturePtop. Instead what we must do is create a new FeaturePtop which includes the point to be inserted, and remove the original.</p>
<div class="tab"> <div class="tablinks" onclick="openTab(event, &apos;CShsnippet&apos;, &apos;tabcontent1&apos;, &apos;tablinks&apos;)">C#</div> </div><div id="CShsnippet" class="tabcontent1"> <div> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> InsertPointIntoFeaturePtop()</div>
<div class="line">        {</div>
<div class="line">            Esprit.FeaturePtop featurePtop = <span class="keyword">null</span>;</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                featurePtop = Document.GetAnyElement(<span class="stringliteral">&quot;Pick Feature Ptop&quot;</span>, EspritConstants.espGraphicObjectType.espFeaturePtop) as Esprit.FeaturePtop;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (System.Runtime.InteropServices.COMException)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Element was not set</span></div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (featurePtop == <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            var previousGridMode = EspritApplication.Configuration.EnableGridMode;</div>
<div class="line">            EspritApplication.Configuration.EnableGridMode = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">            Esprit.Point insertionPoint = <span class="keyword">null</span>;</div>
<div class="line">            Esprit.Point point = <span class="keyword">null</span>;</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                insertionPoint = Document.GetPoint(<span class="stringliteral">&quot;Pick Insertion Location&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (System.Runtime.InteropServices.COMException)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Element was not set</span></div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">            EspritApplication.Configuration.EnableGridMode = previousGridMode;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                point = Document.GetPoint(<span class="stringliteral">&quot;Pick Point To Add&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (System.Runtime.InteropServices.COMException)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Element was not set</span></div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (insertionPoint == <span class="keyword">null</span> || point == <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            var shortestDistance = 0.0;</div>
<div class="line">            var nearestItemIndex = 0;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (var i = 1; i&lt;= featurePtop.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                var distance = Geometry.Distance(featurePtop.Item[i] as Esprit.Point, insertionPoint);</div>
<div class="line">                <span class="keywordflow">if</span> (i == 1)</div>
<div class="line">                {</div>
<div class="line">                    shortestDistance = distance;</div>
<div class="line">                    nearestItemIndex = i;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (distance &lt; shortestDistance)</div>
<div class="line">                    {</div>
<div class="line">                        shortestDistance = distance;</div>
<div class="line">                        nearestItemIndex = i;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            Esprit.FeaturePtop secondFeaturePtop = <span class="keyword">null</span>;</div>
<div class="line">            <span class="keywordflow">if</span> (nearestItemIndex == 1)</div>
<div class="line">            {</div>
<div class="line">                secondFeaturePtop = Document.FeaturePtops.Add(point);</div>
<div class="line">                secondFeaturePtop.Add(featurePtop.Item[1] as Esprit.Point);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nearestItemIndex &gt; 1)</div>
<div class="line">            {</div>
<div class="line">                secondFeaturePtop = Document.FeaturePtops.Add(featurePtop.Item[1] as Esprit.Point);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (var i = 2; i &lt;= featurePtop.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (i == nearestItemIndex)</div>
<div class="line">                {</div>
<div class="line">                    secondFeaturePtop.Add(point);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                secondFeaturePtop.Add(featurePtop.Item[i]);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            Document.FeaturePtops.Remove(featurePtop.Key);</div>
<div class="line">            Document.Refresh();</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div> <div> The following function is used to calculate distance between two points: </div> <div> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">double</span> Distance(Point point1, Point point2 = <span class="keyword">null</span>)</div>
<div class="line">        {</div>
<div class="line">            var x2 = point2?.X ?? 0;</div>
<div class="line">            var y2 = point2?.Y ?? 0;</div>
<div class="line">            var z2 = point2?.Z ?? 0;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> Distance(point1.X, point1.Y, point1.Z, x2, y2, z2);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">double</span> Distance(<span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> y1, <span class="keywordtype">double</span> z1, <span class="keywordtype">double</span> x2, <span class="keywordtype">double</span> y2, <span class="keywordtype">double</span> z2)</div>
<div class="line">        {</div>
<div class="line">            var dx = x2 - x1;</div>
<div class="line">            var dy = y2 - y1;</div>
<div class="line">            var dz = z2 - z1;</div>
<div class="line">            <span class="keywordflow">return</span> Math.Sqrt(dx * dx + dy * dy + dz * dz);</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div></div><div id="CShsnippet" class="tabcontent1"></div><p>Before runing the code make sure you have one or more FeaturePtops in your ESPRIT file. Pick a FeaturePtop, then the insertion location, and a point to add. You should see the point to be added placed ahead of the insertion location. The reason for this is that it allows you to add a point prior to the start point. If you want to add a point after the end point, then you should simply re-open the FeaturePtop and pick the point to add. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript" src="restoreTabs.js"></script>
</body>
</html>
