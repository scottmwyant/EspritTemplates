<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Creating Curves Using FeaturePtop Commands</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="tutorial.css" rel="stylesheet" type="text/css" />
<link href="tab.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="tab.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Creating Curves Using FeaturePtop Commands </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Tutorial: Thrown for a Curve showed how the AddFromElement method creates a curve from another graphics object. A convenient graphic object for associating points together is the FeaturePtop. We can easily create a curve from a feature ptop using AddFromElement, and this gives us the flexibility to use commands built into ESPRIT for feature ptops with curves as well.</p>
<p>First, let us start with a basic function to create a curve from grouped points, only this time by way of a FeaturePtop instead of having to create an array of points as in the Tutorial: Thrown for a Curve.</p>
<p><a class="anchor" id="AnchorGroupedPointsToCurveViaPtop"></a> </p><div class="tab"> <div class="tablinks" onclick="openTab(event, &apos;CShsnippet&apos;, &apos;tabcontent1&apos;, &apos;tablinks&apos;)">C#</div> </div><div id="CShsnippet" class="tabcontent1"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> GroupedPointsToCurveViaPtop()</div>
<div class="line">        {</div>
<div class="line">            Esprit.FeaturePtop featurePtop = <span class="keyword">null</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (var i = 1; i &lt;= Document.Group.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                var graphicObject = Document.Group[i] as Esprit.IGraphicObject;</div>
<div class="line">                <span class="keywordflow">if</span> (graphicObject.GraphicObjectType == EspritConstants.espGraphicObjectType.espPoint)</div>
<div class="line">                {</div>
<div class="line">                    var point = graphicObject as Esprit.Point;</div>
<div class="line">                    <span class="keywordflow">if</span> (featurePtop == <span class="keyword">null</span>)</div>
<div class="line">                    {</div>
<div class="line">                        featurePtop = Document.FeaturePtops.Add(point);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                        featurePtop.Add(point);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (featurePtop == <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                MessageBox.Show(<span class="stringliteral">&quot;There are no selected points&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (featurePtop.Count &gt; 2 &amp;&amp; MessageBox.Show(<span class="stringliteral">&quot;Close the curve?&quot;</span>, <span class="stringliteral">&quot;Close Curve&quot;</span>, MessageBoxButton.YesNo) == MessageBoxResult.Yes)</div>
<div class="line">            {</div>
<div class="line">                featurePtop.Add(featurePtop.Item[1]);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                GraphicObjectHelper.SetDefaultAttributes(Document.Curves.AddFromElement(featurePtop) as Esprit.GraphicObject, EspritApplication.Configuration);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (System.Runtime.InteropServices.COMException)</div>
<div class="line">            { }</div>
<div class="line"> </div>
<div class="line">            Document.FeaturePtops.Remove(featurePtop.Key);</div>
<div class="line">            Document.Refresh();</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> SetDefaultAttributes(Esprit.GraphicObject graphicObject, Esprit.Configuration config)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">switch</span> (graphicObject.GraphicObjectType)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espAnnotation:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationNotes.Color;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espArc:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationArcs.Color;</div>
<div class="line">                    graphicObject.LineType = config.ConfigurationArcs.LineType;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationArcs.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espCircle:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationCircles.Color;</div>
<div class="line">                    graphicObject.LineType = config.ConfigurationCircles.LineType;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationCircles.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espCurve:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationCurves.Color;</div>
<div class="line">                    graphicObject.LineType = config.ConfigurationCurves.LineType;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationCurves.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espDimension:</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espHatch:</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espLeader:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationDimensions.Color;</div>
<div class="line">                    graphicObject.LineType = config.ConfigurationDimensions.LineType;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationDimensions.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espFeatureChain:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationFeatureChains.Color;</div>
<div class="line">                    graphicObject.LineType = config.ConfigurationFeatureChains.LineType;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationFeatureChains.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espFeaturePtop:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationFeaturePtops.Color;</div>
<div class="line">                    graphicObject.LineType = config.ConfigurationFeaturePtops.LineType;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationFeaturePtops.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espLine:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationLines.Color;</div>
<div class="line">                    graphicObject.LineType = config.ConfigurationLines.LineType;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationLines.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espOperation:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationOperations.Color;</div>
<div class="line">                    graphicObject.LineType = config.ConfigurationOperations.LineType;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationOperations.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espPoint:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationPoints.Color;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationPoints.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espSegment:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationSegments.Color;</div>
<div class="line">                    graphicObject.LineType = config.ConfigurationSegments.LineType;</div>
<div class="line">                    graphicObject.LineWeight = config.ConfigurationSegments.LineWeight;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espSolidModel:</div>
<div class="line">                <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espSTL_Model:</div>
<div class="line">                    graphicObject.Color = config.ConfigurationPoints.Color;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>Before running the code, create some points and then group them. Notice how this code prompts the user whether or not to close the curve. This condition could easily be hard-coded or set by some added option.</p>
<p>What can we do with this ability to create curves from ptops? Well, if you use the Add Box command on the Curve toolbar, one limitation that you may run into is that it will only accept the first 200 points in the box. We have already seen how to create a curve from more than 200 points. How could we replace one of the commands on the curve toolbar to run our code? Well, we first saw in Tutorial: Using Class Modules to Respond to ESPRIT Events that the Application has events such as BeforeCommandRun, to let us know when a command is selected. We can check the command ID in that event, and then run our code for the appropriate command. Besides events such as BeforeCommandRun, the Application also has methods such as RunCommand that allow us to run commands on the toolbars by their command ids.</p>
<p>So in BeforeCommandRun event we need to check the Auto Search Curve command that automatically creates a curve from the group. Before creating a curve execute RunCommand for Manual Ptop (id = 3254) and Cycle Stop (id = 3201) commands.</p>
<p><a class="anchor" id="AnchorOnBeforeCommandRun"></a> </p><div class="tab"> <div class="tablinks2" onclick="openTab(event, &apos;CShsnippet2&apos;, &apos;tabcontent2&apos;, &apos;tablinks2&apos;)">C#</div> </div><div id="CShsnippet2" class="tabcontent2"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnBeforeCommandRun(<span class="keywordtype">int</span> nCmdId, <span class="keywordtype">int</span> nAuxId, ref <span class="keywordtype">bool</span> bOverride)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (nCmdId != (<span class="keywordtype">int</span>)EspritConstants.espCommands.espCmdNurb3dCurveAuto)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            var origCount = Document.FeaturePtops.Count;</div>
<div class="line">            EspritApplication.RunCommand(EspritConstants.espCommands.espCmdDefptopNewOpen);</div>
<div class="line">            EspritApplication.RunCommand(EspritConstants.espCommands.espCmdDefstructEndcycle);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (Document.FeaturePtops.Count &gt; origCount)</div>
<div class="line">            {</div>
<div class="line">                var lastPtop = Document.FeaturePtops[Document.FeaturePtops.Count];</div>
<div class="line">                <span class="keywordflow">try</span></div>
<div class="line">                {</div>
<div class="line">                    GraphicObjectHelper.SetDefaultAttributes(Document.Curves.AddFromElement(lastPtop) as Esprit.GraphicObject, EspritApplication.Configuration);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">catch</span> (System.Runtime.InteropServices.COMException)</div>
<div class="line">                { }</div>
<div class="line"> </div>
<div class="line">                Document.FeaturePtops.Remove(lastPtop.Key);</div>
<div class="line"> </div>
<div class="line">                bOverride = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>Group some points, and then click on the Auto Search command on the Curve toolbar. Before running the code, it will prompt you for the Starting Point. Press Esc to abort. Now execute the tutorial code, then click the Auto Search command icon again. This time, it will automatically create a curve through the grouped points. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript" src="restoreTabs.js"></script>
</body>
</html>
