<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Undo</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="tutorial.css" rel="stylesheet" type="text/css" />
<link href="tab.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="tab.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Undo </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Tutorial: Smashing Toolpath to Geometry created geometry from toolpath. That could result in a lot of geometry, so if you chose the wrong operation, it might be hard to remove it again. If you instead tried to select Undo from the menu or press Ctrl+Z, you would find that Undo does not automatically apply to actions taken via the API.</p>
<p>In fact, run any code from any tutorial that creates or deletes graphic elements and then Undo and see what happens. Either Undo will not be available, or it will undo what was done previous to running the tutorials code.</p>
<p>Undo is like a stack or buffer. As commands are executed, the results go into that stack. In order to be able to undo our commands, we need to add them onto the stack via API it can be done using OpenUndoTransaction and CloseUndoTransaction methods from the Document.</p>
<p>You issue an OpenUndoTransaction to start recording to the buffer, and you issue a CloseUndoTransaction to stop. Everything that took place between the open and close will constitute one item in the undo buffer. The CloseUndoTransaction takes a Boolean argument to determine whether or not to keep that item on the stack. If you OpenUndoTransaction to begin to record to the buffer but certain conditions arise such that you do not want to keep that item in the buffer, then you can abort what has been recorded so far by passing False to the commit argument when closing the transaction.</p>
<p>If you actually want a code to execute the undo, rather than waiting for the user to select it from the menu or press Ctrl+Z, then you can use the RunCommand method to issue the undo command (espCmdUndo).</p>
<p>Run this code to undo the last 2 actions:</p>
<p><a class="anchor" id="AnchorUndoTwo"></a> </p><div class="tab"> <div class="tablinks" onclick="openTab(event, &apos;CShsnippet&apos;, &apos;tabcontent1&apos;, &apos;tablinks&apos;)">C#</div> </div><div id="CShsnippet" class="tabcontent1"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> UndoTwo()</div>
<div class="line">        {</div>
<div class="line">            EspritApplication.RunCommand(EspritConstants.espCommands.espCmdUndo);</div>
<div class="line">            EspritApplication.RunCommand(EspritConstants.espCommands.espCmdUndo);</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>As a more practical example, suppose that we want to smash all unsuppressed operations, and be able to undo the whole thing. The code below will make use of the SmashOperation procedure created in the Tutorial: Smashing Toolpath to Geometry. Here is where we need to make use of the OpenUndoTransaction and CloseUndoTransaction methods on the Document. Open an ESPRIT file that contains multiple operations. It might be a good idea to create a new layer and turn off the other layers, to more easily see the geometry created. You can then Run the code and afterwards select Edit &gt; Undo or press Ctrl+Z, then all of the geometry will be removed.</p>
<div class="tab"> <div class="tablinks2" onclick="openTab(event, &apos;CShsnippet2&apos;, &apos;tabcontent2&apos;, &apos;tablinks2&apos;)">C#</div> </div><div id="CShsnippet2" class="tabcontent2"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> SmashAllUnsuppressedOperationsWithUndoAll()</div>
<div class="line">        {</div>
<div class="line">            Document.OpenUndoTransaction();</div>
<div class="line">            <span class="keywordflow">foreach</span> (Esprit.PartOperation operation in Document.PartOperations)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (!operation.Suppress)</div>
<div class="line">                {</div>
<div class="line">                    SmashingToolpathToGeometryTutorial.SmashOperation(operation, EspritApplication);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            Document.Refresh();</div>
<div class="line">            Document.CloseUndoTransaction(<span class="keyword">true</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>The next example shows how to undo each operation that was smashed individually, rather than all of them at once. Open an ESPRIT file that contains multiple, unsupressed operations. You can then Run the code. Afterwards, select Edit &gt; Undo or press Ctrl+Z several times, the geometry will be removed operation by operation.</p>
<div class="tab"> <div class="tablinks3" onclick="openTab(event, &apos;CShsnippet3&apos;, &apos;tabcontent3&apos;, &apos;tablinks3&apos;)">C#</div> </div><div id="CShsnippet3" class="tabcontent3"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> SmashAllUnsuppressedOperationsWithUndoEach()</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">foreach</span> (Esprit.PartOperation operation in Document.PartOperations)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (!operation.Suppress)</div>
<div class="line">                {</div>
<div class="line">                    Document.OpenUndoTransaction();</div>
<div class="line">                    SmashingToolpathToGeometryTutorial.SmashOperation(operation, EspritApplication);</div>
<div class="line">                    Document.CloseUndoTransaction(<span class="keyword">true</span>);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            Document.Refresh();</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><ul>
<li>Here we use smash operation from Tutorial: Smashing Toolpath to Geometry</li>
</ul>
<div class="tab"> <div class="tablinks4" onclick="openTab(event, &apos;CShsnippet4&apos;, &apos;tabcontent4&apos;, &apos;tablinks4&apos;)">C#</div> </div><div id="CShsnippet4" class="tabcontent4"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> SmashOperation(Esprit.PartOperation operation, Esprit.Application app)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (operation == <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">for</span> (var i = 1; i &lt;= operation.ToolPath.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                var toolPathItem = operation.ToolPath.ItemCopy(i);</div>
<div class="line">                <span class="keywordflow">switch</span>(toolPathItem.Type)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">case</span> EspritConstants.espToolPathItemType.tpiEND_POINT:</div>
<div class="line">                    <span class="keywordflow">case</span> EspritConstants.espToolPathItemType.tpiSTART_POINT:</div>
<div class="line">                        var point = toolPathItem.data as EspritGeometryBase.IComPoint;</div>
<div class="line">                        app.Document.Points.Add(point.X, point.Y, point.Z);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">case</span> EspritConstants.espToolPathItemType.tpiSEG2:</div>
<div class="line">                    <span class="keywordflow">case</span> EspritConstants.espToolPathItemType.tpiSEG3:</div>
<div class="line">                        var segment = toolPathItem.data as EspritGeometryBase.IComSegment;</div>
<div class="line">                        app.Document.Segments.Add(</div>
<div class="line">                            app.Document.GetPoint(segment.StartPoint.X, segment.StartPoint.Y, segment.StartPoint.Z),</div>
<div class="line">                            app.Document.GetPoint(segment.EndPoint.X, segment.EndPoint.Y, segment.EndPoint.Z)</div>
<div class="line">                         );</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">case</span> EspritConstants.espToolPathItemType.tpiARC2:</div>
<div class="line">                    <span class="keywordflow">case</span> EspritConstants.espToolPathItemType.tpiARC3:</div>
<div class="line">                        var arc = toolPathItem.data as EspritGeometryBase.IComArc;</div>
<div class="line">                        var newArc = app.Document.Arcs.Add(</div>
<div class="line">                            app.Document.GetPoint(arc.CenterPoint.X, arc.CenterPoint.Y, arc.CenterPoint.Z),</div>
<div class="line">                            arc.Radius, arc.StartAngle, arc.EndAngle);</div>
<div class="line"> </div>
<div class="line">                        newArc.Ux = arc.U.X;</div>
<div class="line">                        newArc.Uy = arc.U.Y;</div>
<div class="line">                        newArc.Uz = arc.U.Z;</div>
<div class="line">                        newArc.Vx = arc.V.X;</div>
<div class="line">                        newArc.Vy = arc.V.Y;</div>
<div class="line">                        newArc.Vz = arc.V.Z;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>It is important that if you issue an OpenUndoTransaction then you must issue a CloseUndoTransaction before issuing another OpenUndoTransaction. Remember you can call CloseUndoTransaction with False as the argument to abort that undo buffer. Therefore, if you have any kind of error trapping or conditions which might cause your code to exit in the middle of a procedure, you should issue just such an abort prior to exit just to be safe. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript" src="restoreTabs.js"></script>
</body>
</html>
