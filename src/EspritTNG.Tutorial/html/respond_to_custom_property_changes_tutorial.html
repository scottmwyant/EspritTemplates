<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Responding to Custom Property Changes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="tutorial.css" rel="stylesheet" type="text/css" />
<link href="tab.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="tab.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Responding to Custom Property Changes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Tutorial: Graphics Events showed how we can use the events of the GraphicsCollection to update a CustomProperty. Well, the OnModify event is triggered if a CustomProperty is changed, too, so let us try the opposite. Let us update the graphics and other properties in response to a change in a CustomProperty.</p>
<p>Suppose that the Diameter property of the Tutorial: Graphics Events was not read-only, so that the user could change it. How could we distinguish the case where the user changes the Radius from the case where the user changes the Diameter? Well, what we could do is have two properties to keep track of the diameter. One would be visible, so that the user could change it, the other would hidden. When the OnModify event is called, we can simply compare the two diameters. If they are different, then we know that the user must have changed the visible one, so we can update the Radius accordingly. If the diameters are the same, then we should check the Radius to see if it had changed, and update the diameters to be twice that value.</p>
<p>First define a class:</p>
<div class="tab"> <div class="tablinks" onclick="openTab(event, &apos;CShsnippet&apos;, &apos;tabcontent1&apos;, &apos;tablinks&apos;)">C#</div> </div><div id="CShsnippet" class="tabcontent1"> <div class="fragment"><div class="line"> </div>
<div class="line">    <span class="keyword">class </span>RespondingToCustomPropertyChangesHandler</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">private</span> readonly Esprit.Application _espritApplication;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> RespondingToCustomPropertyChangesHandler(Esprit.Application app)</div>
<div class="line">        {</div>
<div class="line">            _espritApplication = app;</div>
<div class="line">            app.Document.GraphicsCollection.OnCreate += GraphicsCollectionOnCreate;</div>
<div class="line">            app.Document.GraphicsCollection.OnModify += GraphicsCollectionOnModify;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">foreach</span> (Esprit.GraphicObject circle in app.Document.Circles)</div>
<div class="line">            {</div>
<div class="line">                var <span class="keyword">property</span> = GraphicObjectHelper.GetOrAddCustomProperty(circle, <span class="stringliteral">&quot;Diameter&quot;</span>, EspritConstants.espPropertyType.espPropertyTypeDouble);</div>
<div class="line">                <span class="keyword">property</span>.Caption = <span class="stringliteral">&quot;Diameter&quot;</span>;</div>
<div class="line">                <span class="keyword">property</span>.ReadOnly = <span class="keyword">false</span>;</div>
<div class="line">                <span class="keyword">property</span>.Value = 2 * (circle as Esprit.Circle).Radius;</div>
<div class="line"> </div>
<div class="line">                var previousProperty = GraphicObjectHelper.GetOrAddCustomProperty(circle, <span class="stringliteral">&quot;PreviousDiameter&quot;</span>, EspritConstants.espPropertyType.espPropertyTypeDouble);</div>
<div class="line">                previousProperty.Caption = <span class="stringliteral">&quot;PreviousDiameter&quot;</span>;</div>
<div class="line">                previousProperty.Visible = <span class="keyword">false</span>;</div>
<div class="line">                previousProperty.Value = 2 * (circle as Esprit.Circle).Radius;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> GraphicsCollectionOnCreate(<span class="keywordtype">object</span> graphicsArray)</div>
<div class="line">        {</div>
<div class="line">            var data = graphicsArray as System.Collections.IEnumerable;</div>
<div class="line">            <span class="keywordflow">foreach</span> (Esprit.GraphicObject graphicObject in data)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (graphicObject.GraphicObjectType == EspritConstants.espGraphicObjectType.espCircle)</div>
<div class="line">                {</div>
<div class="line">                    var <span class="keyword">property</span> = GraphicObjectHelper.GetOrAddCustomProperty(graphicObject, <span class="stringliteral">&quot;Diameter&quot;</span>, EspritConstants.espPropertyType.espPropertyTypeDouble);</div>
<div class="line">                    <span class="keyword">property</span>.Caption = <span class="stringliteral">&quot;Diameter&quot;</span>;</div>
<div class="line">                    <span class="keyword">property</span>.ReadOnly = <span class="keyword">false</span>;</div>
<div class="line">                    <span class="keyword">property</span>.Value = 2 * (graphicObject as Esprit.Circle).Radius;</div>
<div class="line"> </div>
<div class="line">                    var previousProperty = GraphicObjectHelper.GetOrAddCustomProperty(graphicObject, <span class="stringliteral">&quot;PreviousDiameter&quot;</span>, EspritConstants.espPropertyType.espPropertyTypeDouble);</div>
<div class="line">                    previousProperty.Caption = <span class="stringliteral">&quot;PreviousDiameter&quot;</span>;</div>
<div class="line">                    previousProperty.Visible = <span class="keyword">false</span>;</div>
<div class="line">                    previousProperty.Value = 2 * (graphicObject as Esprit.Circle).Radius;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> GraphicsCollectionOnModify(<span class="keywordtype">object</span> graphicsArray)</div>
<div class="line">        {</div>
<div class="line">            var data = graphicsArray as System.Collections.IEnumerable;</div>
<div class="line">            <span class="keywordflow">foreach</span>(Esprit.GraphicObject graphicObject in data)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (graphicObject.GraphicObjectType == EspritConstants.espGraphicObjectType.espCircle)</div>
<div class="line">                {</div>
<div class="line">                    var circle = graphicObject as Esprit.Circle;</div>
<div class="line">                    var <span class="keyword">property</span> = GraphicObjectHelper.GetOrAddCustomProperty(graphicObject, <span class="stringliteral">&quot;Diameter&quot;</span>, EspritConstants.espPropertyType.espPropertyTypeDouble);</div>
<div class="line">                    var previousProperty = GraphicObjectHelper.GetOrAddCustomProperty(graphicObject, <span class="stringliteral">&quot;PreviousDiameter&quot;</span>, EspritConstants.espPropertyType.espPropertyTypeDouble);</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (property.Value != previousProperty.Value)</div>
<div class="line">                    {</div>
<div class="line">                        circle.Radius = <span class="keyword">property</span>.Value / 2.0;</div>
<div class="line">                        _espritApplication.Document.Refresh();</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                        <span class="keyword">property</span>.Value = 2 * circle.Radius;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    previousProperty.Value = 2 * circle.Radius;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
</div><!-- fragment --> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">public</span> EspritProperties.CustomProperty GetOrAddCustomProperty(Esprit.IGraphicObject graphicObject, <span class="keywordtype">string</span> name, EspritConstants.espPropertyType type)</div>
<div class="line">        {</div>
<div class="line">            EspritProperties.CustomProperty customProperty = graphicObject.CustomProperties.Item(name);</div>
<div class="line">            <span class="keywordflow">if</span> (customProperty != <span class="keyword">null</span> &amp;&amp; customProperty.VariableType != type)</div>
<div class="line">            {</div>
<div class="line">                graphicObject.CustomProperties.Remove(name);</div>
<div class="line">                customProperty = <span class="keyword">null</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (customProperty == <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                var properties = graphicObject.CustomProperties as EspritProperties.CustomProperties;</div>
<div class="line">                customProperty = (type == EspritConstants.espPropertyType.espPropertyTypeString)</div>
<div class="line">                    ? properties.Add(name, name, type, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line">                    : properties.Add(name, name, type, 0);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> customProperty;</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>Now we can use this class in the following code:</p>
<div class="tab"> <div class="tablinks2" onclick="openTab(event, &apos;CShsnippet2&apos;, &apos;tabcontent2&apos;, &apos;tablinks2&apos;)">C#</div> </div><div id="CShsnippet2" class="tabcontent2"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> RespondingToCustomPropertyChangesHandler _testObject = <span class="keyword">null</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> GraphicsEventExample2()</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (_testObject == <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                _testObject = <span class="keyword">new</span> RespondingToCustomPropertyChangesHandler(EspritApplication);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>Create some circles or check the properties of existing circles. Try changing the Diameter. Is the Radius and graphics updated? Change the Radius instead. Is the Diameter still updated correctly? </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript" src="restoreTabs.js"></script>
</body>
</html>
