<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Automatically Recognizing Feature Start Points</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="tutorial.css" rel="stylesheet" type="text/css" />
<link href="tab.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="tab.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Automatically Recognizing Feature Start Points </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In the Tutorial: Accessing the Features Resulting from FeatureRecognition the feature chains that resulted from FeatureRecognition were returned as an array by the CreateAutoChains method. In addition to looping throught the elements of the array, the elements of the features in the array themselves can be looped through if necessary, just like as was done in Tutorial: Making a FeatureChain into a Spiral.</p>
<p>Suppose, for example, that the file that we are doing feature recognition on includes start points along some of the elements. We can try to Split the feature at that point, and compare the Count before and after. If the count increases, then we know there was a successful split, and we can loop through the elements of the items in the FeatureChain, comparing their endpoints to the point where the split took place.</p>
<div class="tab"> <div class="tablinks" onclick="openTab(event, &apos;CShsnippet&apos;, &apos;tabcontent1&apos;, &apos;tablinks&apos;)">C#</div> </div><div id="CShsnippet" class="tabcontent1"> <div> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Esprit.FeatureChain RestartFeatureChain(Esprit.Document document, Esprit.FeatureChain chainToRestart, Esprit.Point splitPoint)</div>
<div class="line">        {</div>
<div class="line">            var originalCount = chainToRestart.Count;</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                chainToRestart.Split(splitPoint);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (System.Runtime.InteropServices.COMException)</div>
<div class="line">            {</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            var featureChain = chainToRestart;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (chainToRestart.Count &gt; originalCount)</div>
<div class="line">            {</div>
<div class="line">                Esprit.Point endPoint = <span class="keyword">null</span>;</div>
<div class="line">                <span class="keywordflow">for</span> (var i = 1; i &lt;= chainToRestart.Count; i++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">switch</span> (chainToRestart.Item[i].GraphicObjectType)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espArc:</div>
<div class="line">                            var arc = chainToRestart.Item[i] as Esprit.Arc;</div>
<div class="line">                            endPoint = arc.Extremity(EspritConstants.espExtremityType.espExtremityEnd);</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">case</span> EspritConstants.espGraphicObjectType.espSegment:</div>
<div class="line">                            var segment = chainToRestart.Item[i] as Esprit.Segment;</div>
<div class="line">                            endPoint = segment.Extremity(EspritConstants.espExtremityType.espExtremityEnd);</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (endPoint != <span class="keyword">null</span> &amp;&amp; SamePoint(endPoint, splitPoint))</div>
<div class="line">                    {</div>
<div class="line">                        featureChain = document.FeatureChains.Add(splitPoint);</div>
<div class="line">                        <span class="keywordflow">for</span> (var j = i+1; j&lt;= chainToRestart.Count; j++)</div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">try</span></div>
<div class="line">                            {</div>
<div class="line">                                featureChain.Add(chainToRestart.Item[j]);</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">catch</span> (Exception)</div>
<div class="line">                            { }</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">for</span> (var j = 1; j &lt;= i; j++)</div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">try</span></div>
<div class="line">                            {</div>
<div class="line">                                featureChain.Add(chainToRestart.Item[j]);</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">catch</span> (Exception)</div>
<div class="line">                            { }</div>
<div class="line">                        }</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> featureChain;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> SamePoint(Esprit.Point point1, Esprit.Point point2)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> ((point1.X == point2.X) &amp;&amp; (point1.Y == point2.Y) &amp;&amp; (point1.Z == point2.Z));</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div></div><div id="CShsnippet" class="tabcontent1"></div><p>With the functions above, we only need to slightly modify the code of the Tutorial: Accessing the Features Resulting from FeatureRecognition to loop through all of the points in the file and try to find the start point. Insert the code shown below:</p>
<p><a class="anchor" id="AnchorChainAllCWCloseGapsAndChangeStart"></a>ChainAllCWCloseGapsAndChangeStart</p>
<div class="tab"> <div class="tablinks2" onclick="openTab(event, &apos;CShsnippet2&apos;, &apos;tabcontent2&apos;, &apos;tablinks2&apos;)">C#</div> </div><div id="CShsnippet2" class="tabcontent2"> <div> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> ChainAllCWCloseGapsAndChangeStart()</div>
<div class="line">        {</div>
<div class="line">            var <span class="keyword">set</span> = SelectionSetHelper.GetOrAddSelectionSet(Document.SelectionSets, <span class="stringliteral">&quot;Temp&quot;</span>);</div>
<div class="line">            <span class="keyword">set</span>.RemoveAll();</div>
<div class="line"> </div>
<div class="line">            var set2 = SelectionSetHelper.GetOrAddSelectionSet(Document.SelectionSets, <span class="stringliteral">&quot;Temp2&quot;</span>);</div>
<div class="line">            set2.RemoveAll();</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">foreach</span> (Esprit.IGraphicObject graphicObject in Document.GraphicsCollection)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (graphicObject.GraphicObjectType == EspritConstants.espGraphicObjectType.espArc || graphicObject.GraphicObjectType == EspritConstants.espGraphicObjectType.espSegment)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keyword">set</span>.Add(graphicObject);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<span class="keyword">set</span>.Count == 0)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            var objects = Document.FeatureRecognition.CreateAutoChains(<span class="keyword">set</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (var i = objects.GetLowerBound(0); i &lt;= objects.GetUpperBound(0); i++)</div>
<div class="line">            {</div>
<div class="line">                var graphicObject = objects.GetValue(i) as Esprit.GraphicObject;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (graphicObject.GraphicObjectType == EspritConstants.espGraphicObjectType.espFeatureChain)</div>
<div class="line">                {</div>
<div class="line">                    var featureChain = graphicObject as Esprit.FeatureChain;</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (!featureChain.IsClosed)</div>
<div class="line">                    {</div>
<div class="line">                        var startPoint = featureChain.Extremity(EspritConstants.espExtremityType.espExtremityStart);</div>
<div class="line">                        var endPoint = featureChain.Extremity(EspritConstants.espExtremityType.espExtremityEnd);</div>
<div class="line">                        <span class="keywordflow">if</span> (Geometry.Distance(startPoint, endPoint) &lt; EspritApplication.Configuration.ConfigurationFeatureRecognition.Tolerance)</div>
<div class="line">                        {</div>
<div class="line">                            featureChain.Add(startPoint);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> (featureChain.IsClosed) <span class="comment">// check again</span></div>
<div class="line">                    {</div>
<div class="line">                        set2.AddCopiesToSelectionSet = <span class="keyword">true</span>;</div>
<div class="line">                        set2.RemoveAll();</div>
<div class="line"> </div>
<div class="line">                        set2.Add(featureChain);</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">try</span></div>
<div class="line">                        {</div>
<div class="line">                            set2.Offset(0.001, EspritConstants.espOffsetSide.espOffsetRight, <span class="keyword">false</span>, EspritConstants.espLookAheadMode.espLookAheadOn, <span class="keyword">true</span>);</div>
<div class="line">                            var offsetFeatureChain = set2[2] as Esprit.FeatureChain;</div>
<div class="line">                            <span class="keywordflow">if</span> (offsetFeatureChain.Area &gt; featureChain.Area)</div>
<div class="line">                            {</div>
<div class="line">                                featureChain.Reverse();</div>
<div class="line">                            }</div>
<div class="line">                            Document.FeatureChains.Remove(offsetFeatureChain.Key);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">catch</span>(Exception)</div>
<div class="line">                        { }</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">foreach</span>(Esprit.Point point in Document.Points)</div>
<div class="line">                    {</div>
<div class="line">                        var newFC = RestartFeatureChain(Document, featureChain, point);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            Document.SelectionSets.Remove(<span class="keyword">set</span>.Name);</div>
<div class="line">            Document.SelectionSets.Remove(set2.Name);</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> SelectionSet GetOrAddSelectionSet(ISelectionSets selectionSets, <span class="keywordtype">string</span> name)</div>
<div class="line">        {</div>
<div class="line">            var <span class="keyword">set</span> = selectionSets[name] ?? selectionSets.Add(name);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">set</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div> <div> The following function is used to calculate distance between two points: </div> <div> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">double</span> Distance(Point point1, Point point2 = <span class="keyword">null</span>)</div>
<div class="line">        {</div>
<div class="line">            var x2 = point2?.X ?? 0;</div>
<div class="line">            var y2 = point2?.Y ?? 0;</div>
<div class="line">            var z2 = point2?.Z ?? 0;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> Distance(point1.X, point1.Y, point1.Z, x2, y2, z2);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">double</span> Distance(<span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> y1, <span class="keywordtype">double</span> z1, <span class="keywordtype">double</span> x2, <span class="keywordtype">double</span> y2, <span class="keywordtype">double</span> z2)</div>
<div class="line">        {</div>
<div class="line">            var dx = x2 - x1;</div>
<div class="line">            var dy = y2 - y1;</div>
<div class="line">            var dz = z2 - z1;</div>
<div class="line">            <span class="keywordflow">return</span> Math.Sqrt(dx * dx + dy * dy + dz * dz);</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div></div><div id="CShsnippet2" class="tabcontent2"></div><p>Before running the code, if necessary, place some midpoints on your geometry using the Snap option of the Point command. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript" src="restoreTabs.js"></script>
</body>
</html>
