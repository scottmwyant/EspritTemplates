<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Graphics Events</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="tutorial.css" rel="stylesheet" type="text/css" />
<link href="tab.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="tab.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Graphics Events </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In Tutorial: Introduction to Custom Properties we added a custom Diameter property to all of our circles. However, new circles that were created after we ran this code would not have the Diameter property, and existing circles that had their Radius value changed did not have the Diameter already updated. How can we ensure that all of our circles always have a correct Diameter value?</p>
<p>We need to know when circles are created and modified. If we search the ESPRIT library, we will discover that the GraphicsCollection has OnCreate and OnModify events. Those events are triggered whenever graphics are created or modified.</p>
<p>First define a class that responds to those events and loops through GraphicsArray containing all of the GraphicObject objects that were created or modified to pick out the circles:</p>
<div class="tab"> <div class="tablinks" onclick="openTab(event, &apos;CShsnippet&apos;, &apos;tabcontent1&apos;, &apos;tablinks&apos;)">C#</div> </div><div id="CShsnippet" class="tabcontent1"> <div class="fragment"><div class="line"> </div>
<div class="line">    <span class="keyword">class </span>GraphicsEventsHandler</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> GraphicsEventsHandler(Esprit.Application app)</div>
<div class="line">        {</div>
<div class="line">            app.Document.GraphicsCollection.OnCreate += GraphicsCollectionOnCreate;</div>
<div class="line">            app.Document.GraphicsCollection.OnModify += GraphicsCollectionOnModify;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">foreach</span> (Esprit.GraphicObject circle in app.Document.Circles)</div>
<div class="line">            {</div>
<div class="line">                var <span class="keyword">property</span> = GraphicObjectHelper.GetOrAddCustomProperty(circle, <span class="stringliteral">&quot;Diameter&quot;</span>, EspritConstants.espPropertyType.espPropertyTypeDouble);</div>
<div class="line">                <span class="keyword">property</span>.Caption = <span class="stringliteral">&quot;Diameter&quot;</span>;</div>
<div class="line">                <span class="keyword">property</span>.ReadOnly = <span class="keyword">true</span>;</div>
<div class="line">                <span class="keyword">property</span>.Value = 2 * (circle as Esprit.Circle).Radius;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> GraphicsCollectionOnCreate(<span class="keywordtype">object</span> graphicsArray)</div>
<div class="line">        {</div>
<div class="line">            var data = graphicsArray as System.Collections.IEnumerable;</div>
<div class="line">            <span class="keywordflow">foreach</span> (Esprit.GraphicObject graphicObject in data)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (graphicObject.GraphicObjectType == EspritConstants.espGraphicObjectType.espCircle)</div>
<div class="line">                {</div>
<div class="line">                    var <span class="keyword">property</span> = GraphicObjectHelper.GetOrAddCustomProperty(graphicObject, <span class="stringliteral">&quot;Diameter&quot;</span>, EspritConstants.espPropertyType.espPropertyTypeDouble);</div>
<div class="line">                    <span class="keyword">property</span>.Caption = <span class="stringliteral">&quot;Diameter&quot;</span>;</div>
<div class="line">                    <span class="keyword">property</span>.ReadOnly = <span class="keyword">true</span>;</div>
<div class="line">                    <span class="keyword">property</span>.Value = 2 * (graphicObject as Esprit.Circle).Radius;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> GraphicsCollectionOnModify(<span class="keywordtype">object</span> graphicsArray)</div>
<div class="line">        {</div>
<div class="line">            var data = graphicsArray as System.Collections.IEnumerable;</div>
<div class="line">            <span class="keywordflow">foreach</span>(Esprit.GraphicObject graphicObject in data)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (graphicObject.GraphicObjectType == EspritConstants.espGraphicObjectType.espCircle)</div>
<div class="line">                {</div>
<div class="line">                    var <span class="keyword">property</span> = GraphicObjectHelper.GetOrAddCustomProperty(graphicObject, <span class="stringliteral">&quot;Diameter&quot;</span>, EspritConstants.espPropertyType.espPropertyTypeDouble);</div>
<div class="line">                    <span class="keyword">property</span>.Value = 2 * (graphicObject as Esprit.Circle).Radius;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
</div><!-- fragment --> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">public</span> EspritProperties.CustomProperty GetOrAddCustomProperty(Esprit.IGraphicObject graphicObject, <span class="keywordtype">string</span> name, EspritConstants.espPropertyType type)</div>
<div class="line">        {</div>
<div class="line">            EspritProperties.CustomProperty customProperty = graphicObject.CustomProperties.Item(name);</div>
<div class="line">            <span class="keywordflow">if</span> (customProperty != <span class="keyword">null</span> &amp;&amp; customProperty.VariableType != type)</div>
<div class="line">            {</div>
<div class="line">                graphicObject.CustomProperties.Remove(name);</div>
<div class="line">                customProperty = <span class="keyword">null</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (customProperty == <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                var properties = graphicObject.CustomProperties as EspritProperties.CustomProperties;</div>
<div class="line">                customProperty = (type == EspritConstants.espPropertyType.espPropertyTypeString)</div>
<div class="line">                    ? properties.Add(name, name, type, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line">                    : properties.Add(name, name, type, 0);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> customProperty;</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>Now we can use this class in the following code:</p>
<div class="tab"> <div class="tablinks2" onclick="openTab(event, &apos;CShsnippet2&apos;, &apos;tabcontent2&apos;, &apos;tablinks2&apos;)">C#</div> </div><div id="CShsnippet2" class="tabcontent2"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> GraphicsEventsHandler _testObject = <span class="keyword">null</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> GraphicsEventExample()</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (_testObject == <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                _testObject = <span class="keyword">new</span> GraphicsEventsHandler(EspritApplication);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><p>Before running the code, create some circles and look at their properties. Check the circles that were created before. Do they all have a Diameter property? Create some new circles and then look at their properties. Was Diameter immediately added to them, also? Change the radius of some of the circles. Does the Diameter value update accordingly? </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript" src="restoreTabs.js"></script>
</body>
</html>
