<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Using Registry Values with UserForms</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="tutorial.css" rel="stylesheet" type="text/css" />
<link href="tab.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="tab.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Using Registry Values with UserForms </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Tutorial: Saving Values to the Registry showed how to save and retrieve values to and from the registry. This tutorial will use those same methods to save and retrieve the values on a UserForm. We will read values from the registry during the UserForm initialize event and save values to the registry during the UserForm close event. For simplicity, let us just add an interface to the ChainCircles function from Tutorial: More Fun With Functions and SelectionSets.</p>
<p>Arrange the control on the form and align them if you like. When you are finished, your form should look similar to the one below.</p>
<div class="image">
<img src="RegistryValuesWithUserFormsTutorial.png" alt=""/>
</div>
<p>Set the properties of each control to the following values:</p>
<center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Object Type </th><th class="markdownTableHeadCenter">Name </th><th class="markdownTableHeadCenter">Properties  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">UserForm </td><td class="markdownTableBodyCenter">frmUserFormsTutorial </td><td class="markdownTableBodyCenter">Caption = Chain Mold Holes  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Label </td><td class="markdownTableBodyCenter">lblHoleRadius </td><td class="markdownTableBodyCenter">Caption = Hole Radius  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Label </td><td class="markdownTableBodyCenter">lblSpacing </td><td class="markdownTableBodyCenter">Caption = Spacing  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Label </td><td class="markdownTableBodyCenter">lblStartAngle </td><td class="markdownTableBodyCenter">Caption = Start Angle  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TextBox </td><td class="markdownTableBodyCenter">txtHoleRadius </td><td class="markdownTableBodyCenter">TextAlign = 3 - fmTextAlignRight  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">TextBox </td><td class="markdownTableBodyCenter">txtSpacing </td><td class="markdownTableBodyCenter">TextAlign = 3 - fmTextAlignRight  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TextBox </td><td class="markdownTableBodyCenter">txtStartAngle </td><td class="markdownTableBodyCenter">TextAlign = 3 - fmTextAlignRight  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CommandButton </td><td class="markdownTableBodyCenter">cmdCancel </td><td class="markdownTableBodyCenter">Caption = Cancel  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CommandButton </td><td class="markdownTableBodyCenter">cmdOK </td><td class="markdownTableBodyCenter">Caption = OK  </td></tr>
</table>
</center><p>Assosiate the following event procedures with the form:</p>
<ul>
<li>Cancel Button:</li>
</ul>
<div class="tab"> <div class="tablinks" onclick="openTab(event, &apos;CShsnippet&apos;, &apos;tabcontent1&apos;, &apos;tablinks&apos;)">C#</div> </div><div id="CShsnippet" class="tabcontent1"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnCancelButtonClick(<span class="keywordtype">object</span> sender, EventArgs e)</div>
<div class="line">        {</div>
<div class="line">            CloseForm();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">void</span> CloseForm()</div>
<div class="line">        {</div>
<div class="line">            _form.Close();</div>
<div class="line">            _form = <span class="keyword">null</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><ul>
<li>Ok Button:</li>
</ul>
<div class="tab"> <div class="tablinks2" onclick="openTab(event, &apos;CShsnippet2&apos;, &apos;tabcontent2&apos;, &apos;tablinks2&apos;)">C#</div> </div><div id="CShsnippet2" class="tabcontent2"> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnOkButtonClick(<span class="keywordtype">object</span> sender, EventArgs e)</div>
<div class="line">        {</div>
<div class="line">            Esprit.Circle circle = <span class="keyword">null</span>;</div>
<div class="line"> </div>
<div class="line">            _form.Hide();</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                circle = Document.GetCircle(<span class="stringliteral">&quot;Pick BoundaryCircle&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (System.Runtime.InteropServices.COMException)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Element was not set</span></div>
<div class="line">                _form.Show();</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordtype">double</span>.TryParse(_txtHoleRadius.Text, out var holeRadius);</div>
<div class="line">            <span class="keywordtype">double</span>.TryParse(_txtSpacing.Text, out var spacing);</div>
<div class="line">            <span class="keywordtype">int</span>.TryParse(_txtStartAngle.Text, out var startAngle);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (circle != <span class="keyword">null</span>)</div>
<div class="line">            {</div>
<div class="line">                FeatureHelper.ChainCircles(</div>
<div class="line">                    Document,</div>
<div class="line">                    FeatureHelper.MoldHolePattern(Document, circle.CenterPoint, circle.Radius, holeRadius, spacing), startAngle * Math.PI / 180</div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            Document.Refresh();</div>
<div class="line"> </div>
<div class="line">            CloseForm();</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> SelectionSet ChainCircles(Document document, SelectionSet selectionSet, <span class="keywordtype">double</span> startAngle)</div>
<div class="line">        {</div>
<div class="line">            var chainCircles = SelectionSetHelper.AddUniqueSelectionSet(document.SelectionSets, <span class="stringliteral">&quot;ChainCircles&quot;</span>);</div>
<div class="line">            <span class="keywordflow">for</span> (var i = 1; i &lt;= selectionSet.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                var graphicObject = selectionSet[i] as IGraphicObject;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (graphicObject.GraphicObjectType != espGraphicObjectType.espCircle)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                var circle = graphicObject as Circle;</div>
<div class="line">                var featureChain = document.FeatureChains.Add(document.GetPoint(circle.CenterPoint.X + circle.Radius * Math.Cos(startAngle), circle.CenterPoint.Y + circle.Radius * Math.Sin(startAngle), circle.CenterPoint.Z));</div>
<div class="line">                featureChain.Add(document.GetArc(circle.CenterPoint, circle.Radius, startAngle, startAngle + 2 * Math.PI));</div>
<div class="line">                chainCircles.Add(featureChain);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> chainCircles;</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --> <div class="fragment"><div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> SelectionSet MoldHolePattern(Document document, Point center, <span class="keywordtype">double</span> boundaryRadius, <span class="keywordtype">double</span> holeRadius, <span class="keywordtype">double</span> spacing)</div>
<div class="line">        {</div>
<div class="line">            var moldHolePattern = SelectionSetHelper.AddUniqueSelectionSet(document.SelectionSets, <span class="stringliteral">&quot;MoldHole&quot;</span>);</div>
<div class="line">            <span class="keywordflow">if</span> (boundaryRadius &lt; holeRadius)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> moldHolePattern;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            var hole = document.Circles.Add(center, holeRadius);</div>
<div class="line">            moldHolePattern.Add(hole);</div>
<div class="line"> </div>
<div class="line">            var centerDistance = spacing + 2 * holeRadius;</div>
<div class="line">            uint ring = 0;</div>
<div class="line">            var holesOnRing = 0;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">do</span></div>
<div class="line">            {</div>
<div class="line">                ring++;</div>
<div class="line">                holesOnRing = 0;</div>
<div class="line">                var x = center.X + ring * centerDistance;</div>
<div class="line">                var y = center.Y;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (var sideAngleInDegrees = 120; sideAngleInDegrees &lt;= 420; sideAngleInDegrees += 60)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">for</span> (var holeOnSide = 1; holeOnSide &lt;= ring; holeOnSide++)</div>
<div class="line">                    {</div>
<div class="line">                        x = x + centerDistance * Math.Cos(sideAngleInDegrees * Math.PI / 180);</div>
<div class="line">                        y = y + centerDistance * Math.Sin(sideAngleInDegrees * Math.PI / 180);</div>
<div class="line"> </div>
<div class="line">                        var outerTangent = Geometry.Distance(x, y, center.X, center.Y) + holeRadius + spacing;</div>
<div class="line">                        <span class="keywordflow">if</span> (outerTangent &lt; boundaryRadius)</div>
<div class="line">                        {</div>
<div class="line">                            hole = document.Circles.Add(document.GetPoint(x, y, center.Z), holeRadius);</div>
<div class="line">                            moldHolePattern.Add(hole);</div>
<div class="line">                            holesOnRing++;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">while</span> (holesOnRing != 0);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> moldHolePattern;</div>
<div class="line">        }</div>
<div class="line"> </div>
</div><!-- fragment --></div><ul>
<li>Form initialize event (reading values from the registry):</li>
</ul>
<div class="tab"> <div class="tablinks3" onclick="openTab(event, &apos;CShsnippet3&apos;, &apos;tabcontent3&apos;, &apos;tablinks3&apos;)">C#</div> </div><div id="CShsnippet3" class="tabcontent3"> <div class="fragment"><div class="line"> </div>
<div class="line">            var scaleFactor = (Document.SystemUnit == EspritConstants.espUnitType.espMetric)</div>
<div class="line">                ? 25.4</div>
<div class="line">                : 1;</div>
<div class="line"> </div>
<div class="line">            var reg = RegistryHelper.GetRegistry();</div>
<div class="line">            _txtHoleRadius.Text = reg.GetValue(<span class="stringliteral">&quot;Hole Radius&quot;</span>, 0.5 * scaleFactor).ToString();</div>
<div class="line">            _txtSpacing.Text = reg.GetValue(<span class="stringliteral">&quot;Spacing&quot;</span>, 0.1 * scaleFactor).ToString();</div>
<div class="line">            _txtStartAngle.Text = reg.GetValue(<span class="stringliteral">&quot;Start Angle&quot;</span>, 0).ToString();</div>
<div class="line"> </div>
</div><!-- fragment --></div><ul>
<li>Form close event (saving values to the registry):</li>
</ul>
<div class="tab"> <div class="tablinks4" onclick="openTab(event, &apos;CShsnippet4&apos;, &apos;tabcontent4&apos;, &apos;tablinks4&apos;)">C#</div><p> <br  />
 </div><div id="CShsnippet4" class="tabcontent4"> <div class="fragment"><div class="line"> </div>
<div class="line">            _form.FormClosed += (o, e) =&gt; {</div>
<div class="line">                reg.SetValue(<span class="stringliteral">&quot;Spacing&quot;</span>, _txtSpacing.Text);</div>
<div class="line">                reg.SetValue(<span class="stringliteral">&quot;Hole Radius&quot;</span>, _txtHoleRadius.Text);</div>
<div class="line">                reg.SetValue(<span class="stringliteral">&quot;Start Angle&quot;</span>, _txtStartAngle.Text);</div>
<div class="line"> </div>
<div class="line">                _form = <span class="keyword">null</span>;</div>
<div class="line">            };</div>
<div class="line"> </div>
</div><!-- fragment --></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript" src="restoreTabs.js"></script>
</body>
</html>
